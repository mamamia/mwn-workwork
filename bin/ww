#!/bin/bash

# Exit immediately if a command exits with a non-zero status
set -e

# Enables pattern lists like @(init|start|updatedb)
# Credit: http://stackoverflow.com/a/13254908
shopt -s extglob

# Load in functions
WW_DIR="${HOME}/workspace/mwn-workwork"
cd $WW_DIR
source ./lib/vars
source ./lib/utils
source ./lib/display
source ./lib/workstation
source ./lib/init
source ./lib/start
source ./lib/stop
source ./lib/update
source ./lib/updatedb
source ./lib/run

check_shell
check_platform

case "$1" in
  $VALID_COMMANDS)
    case "$2" in
      $VALID_SITES)
        setup_site $2
        run_$1 $2
        ;;
      $INVALID_SITES)
        print_status_primary "ERROR" "Invalid or missing argument"
        print_help
        ;;
    esac
    ;;
  --update)
    check_version
    ;;
  --help)
    print_help
    ;;
  --version)
    print_version
    ;;
  --workstation)
    run_workstation
    ;;
  --shutdown)
    run_shutdown
    ;;
  *)
    case "$2" in
      *)
        print_status_primary "ERROR" "Invalid command '$1'"
        print_help
        ;;
      esac
    ;;
esac
